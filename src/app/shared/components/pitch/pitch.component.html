<div
  class="pitch relative w-full max-h-[85vh] rounded text-white overflow-hidden border-4 border-white/20 shadow-2xl select-none mx-auto max-w-2xl"
  style="aspect-ratio: 3/4;">

  <!-- Pitch Markings -->
  <div class="absolute inset-0 pointer-events-none opacity-50">
    <!-- Center Line -->
    <div class="absolute top-1/2 left-0 w-full h-0.5 bg-white/80 -translate-y-1/2"></div>
    <!-- Center Circle -->
    <div
      class="absolute top-1/2 left-1/2 w-32 h-32 border-2 border-white/80 rounded-full -translate-x-1/2 -translate-y-1/2">
    </div>
    <!-- Center Dot -->
    <div class="absolute top-1/2 left-1/2 w-2 h-2 bg-white rounded-full -translate-x-1/2 -translate-y-1/2"></div>
    <!-- Penalty Areas -->
    <div class="absolute top-0 left-1/2 w-[70%] h-[16%] border-b-2 border-x-2 border-white/80 -translate-x-1/2"></div>
    <div class="absolute bottom-0 left-1/2 w-[70%] h-[16%] border-t-2 border-x-2 border-white/80 -translate-x-1/2">
    </div>
    <!-- Goal Areas -->
    <div class="absolute top-0 left-1/2 w-[35%] h-[6%] border-b-2 border-x-2 border-white/80 -translate-x-1/2"></div>
    <div class="absolute bottom-0 left-1/2 w-[35%] h-[6%] border-t-2 border-x-2 border-white/80 -translate-x-1/2"></div>
    <!-- Goals -->
    <div class="absolute top-0 left-1/2 w-16 h-1.5 bg-white/60 -translate-x-1/2"></div>
    <div class="absolute bottom-0 left-1/2 w-16 h-1.5 bg-white/60 -translate-x-1/2"></div>
  </div>

  <!-- Player Positions -->
  @for (pos of positions; track $index) {
  <div cdkDropList [id]="'pos-' + $index" [cdkDropListData]="[players[$index]]" (cdkDropListDropped)="drop.emit($event)"
    class="absolute w-14 h-14 -translate-x-1/2 -translate-y-1/2 flex items-center justify-center z-10"
    [style.left.%]="pos.x * 100" [style.top.%]="pos.y * 100">

    <!-- Empty Slot -->
    @if (!players[$index]) {
    <div
      class="w-10 h-10 rounded-full bg-black/40 border-2 border-dashed border-white/40 flex items-center justify-center">
      <span class="text-[9px] text-white/80 font-bold">{{ pos.role }}</span>
    </div>
    }

    <!-- Player on Slot -->
    @if (players[$index]; as player) {
    <div cdkDrag [cdkDragData]="player" class="cursor-grab active:cursor-grabbing hover:scale-110 transition-transform">
      <app-player-marker [player]="player" [position]="pos.role"></app-player-marker>
      <div *cdkDragPreview class="scale-110 opacity-90">
        <app-player-marker [player]="player" [position]="pos.role"></app-player-marker>
      </div>
      <div *cdkDragPlaceholder class="w-10 h-10 rounded-full bg-white/20 border border-white/30"></div>
    </div>
    }
  </div>
  }
</div>